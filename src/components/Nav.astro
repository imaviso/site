---
import ThemeToggle from "./ThemeToggle.astro";

interface Props {
  currentPath?: string;
}

const { currentPath = "" } = Astro.props;

const navLinks = [
  { href: "/projects", label: "Projects" },
  { href: "/contact", label: "Contact" },
  { href: "https://github.com/imaviso", label: "GitHub", external: true },
];
---

<nav class="border-b border-[var(--color-border)] shrink-0 bg-[var(--color-bg)] z-[100] transition-colors duration-300">
  <!-- Main nav bar -->
  <div class="flex justify-between items-center h-14 px-6 md:px-8">
    <!-- Logo -->
    <a 
      href="/" 
      class="font-[var(--font-mono)] text-base font-normal tracking-wide text-[var(--color-fg)] no-underline transition-all duration-200 flex items-center gap-1.5 group"
    >
      <span class="text-[var(--color-dim)] group-hover:text-[var(--color-muted)] transition-colors duration-200">&gt;</span>
      <span class="group-hover:tracking-wider transition-all duration-200">imaviso</span>
      <span class="cursor-blink text-[var(--color-accent)]">_</span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex gap-6 items-center">
      {navLinks.map((link) => {
        const isActive = currentPath === link.href;
        return (
          <a 
            href={link.href} 
            target={link.external ? "_blank" : undefined}
            rel={link.external ? "noopener noreferrer" : undefined}
            class:list={[
              "nav-link text-[0.85rem] no-underline transition-all duration-200 flex items-center gap-1.5",
              isActive ? "active" : ""
            ]}
            aria-current={isActive ? "page" : undefined}
          >
            <span>{link.label}</span>
            {link.external && (
              <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-40">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15 3 21 3 21 9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
              </svg>
            )}
          </a>
        );
      })}
      
      <!-- Separator -->
      <div class="w-px h-4 bg-[var(--color-border)]"></div>
      
      <ThemeToggle />
    </div>

    <!-- Mobile: Theme Toggle + Hamburger -->
    <div class="flex md:hidden items-center gap-1">
      <ThemeToggle />
      <button
        id="mobile-menu-btn"
        type="button"
        class="p-2.5 text-[var(--color-muted)] hover:text-[var(--color-fg)] transition-colors duration-200"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <!-- Hamburger icon -->
        <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6" x2="20" y2="6"/>
          <line x1="4" y1="12" x2="20" y2="12"/>
          <line x1="4" y1="18" x2="20" y2="18"/>
        </svg>
        <!-- Close icon -->
        <svg id="close-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-[var(--color-border)] mobile-menu-open bg-[var(--color-bg)]">
    <div class="px-6 py-4 flex flex-col gap-1">
      {navLinks.map((link) => {
        const isActive = currentPath === link.href;
        return (
          <a 
            href={link.href} 
            target={link.external ? "_blank" : undefined}
            rel={link.external ? "noopener noreferrer" : undefined}
            class:list={[
              "flex items-center justify-between py-3 px-2 text-[0.9rem] font-[var(--font-mono)] transition-all duration-200 -mx-2 rounded-sm",
              isActive ? "text-[var(--color-fg)] bg-[var(--color-glow)]" : "text-[var(--color-muted)] hover:text-[var(--color-fg)] hover:bg-[var(--color-glow)]"
            ]}
            aria-current={isActive ? "page" : undefined}
          >
            <span>{link.label}</span>
            {link.external ? (
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-40">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15 3 21 3 21 9"/>
                <line x1="10" y1="14" x2="21" y2="3"/>
              </svg>
            ) : (
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-40">
                <path d="M5 12h14"/>
                <path d="m12 5 7 7-7 7"/>
              </svg>
            )}
          </a>
        );
      })}
    </div>
  </div>
</nav>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    menuBtn?.addEventListener('click', () => {
      const isOpen = mobileMenu?.classList.toggle('hidden');
      menuIcon?.classList.toggle('hidden');
      closeIcon?.classList.toggle('hidden');
      menuBtn?.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
    });

    // Close menu when clicking a link
    mobileMenu?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu?.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        menuBtn?.setAttribute('aria-expanded', 'false');
      });
    });
  }

  // Run on initial load
  initMobileMenu();

  // Re-run after view transitions
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>
